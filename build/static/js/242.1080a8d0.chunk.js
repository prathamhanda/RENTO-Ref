"use strict";(self.webpackChunkroomsonrent_frontend=self.webpackChunkroomsonrent_frontend||[]).push([[242],{2242:(e,s,t)=>{t.r(s),t.d(s,{default:()=>x});var a=t(5043),r=t(5475),n=t(3216),c=t(9133),l=t(2171),o=t(7760),i=t(5336),d=t(2746),m=t(579);const x=()=>{const[e]=(0,r.ok)(),s=(0,n.Zp)(),{user:t}=(0,c.As)(),{getListingById:x}=(0,l.i)(),{createBooking:h,loading:u,error:g}=(0,o.B)(),p=e.get("listingId"),[j,f]=(0,a.useState)(null),[b,N]=(0,a.useState)({checkInDate:"",duration:1,occupants:1,message:""}),[y,v]=(0,a.useState)({}),[k,w]=(0,a.useState)(!0),[F,D]=(0,a.useState)(null);(0,a.useEffect)((()=>{if(!t)return void s("/login",{state:{from:`/bookings/new?listingId=${p}`}});if(!p)return void s("/search");(async()=>{try{const e=await x(p);f(e);const s=new Date;s.setDate(s.getDate()+1),N((e=>({...e,checkInDate:s.toISOString().split("T")[0]}))),w(!1)}catch(e){console.error("Error fetching listing:",e),D("Failed to load listing details. Please try again."),w(!1)}})()}),[p,x,s,t]);const I=e=>{const{name:s,value:t}=e.target;N((e=>({...e,[s]:"duration"===s||"occupants"===s?parseInt(t,10):t}))),y[s]&&v((e=>({...e,[s]:null})))},C=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e),E=()=>j?j.price*b.duration:0;return k?(0,m.jsx)(i.A,{children:(0,m.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,m.jsx)(d.A,{size:"large",color:"indigo"})})}):F||!j?(0,m.jsx)(i.A,{children:(0,m.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,m.jsx)("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 rounded-md",children:(0,m.jsxs)("div",{className:"flex",children:[(0,m.jsx)("div",{className:"flex-shrink-0",children:(0,m.jsx)("svg",{className:"h-5 w-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,m.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,m.jsx)("div",{className:"ml-3",children:(0,m.jsx)("p",{className:"text-sm text-red-700",children:F||"Listing not found. Please try again."})})]})}),(0,m.jsx)("div",{className:"mt-4 text-center",children:(0,m.jsx)(r.N_,{to:"/search",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-[#FE6F61] hover:bg-[#e55a4d] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#FE6F61]",children:"Browse Listings"})})]})}):(0,m.jsx)(i.A,{children:(0,m.jsx)("div",{className:"bg-gray-50 min-h-screen",children:(0,m.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,m.jsx)("nav",{className:"flex mb-4","aria-label":"Breadcrumb",children:(0,m.jsxs)("ol",{className:"flex items-center space-x-2",children:[(0,m.jsx)("li",{children:(0,m.jsx)(r.N_,{to:"/",className:"text-gray-500 hover:text-gray-700",children:"Home"})}),(0,m.jsxs)("li",{className:"flex items-center",children:[(0,m.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,m.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),(0,m.jsx)(r.N_,{to:`/listings/${p}`,className:"ml-2 text-gray-500 hover:text-gray-700",children:j.title})]}),(0,m.jsxs)("li",{className:"flex items-center",children:[(0,m.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,m.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),(0,m.jsx)("span",{className:"ml-2 text-gray-900 font-medium",children:"Book Now"})]})]})}),(0,m.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,m.jsx)("div",{className:"lg:col-span-2",children:(0,m.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[(0,m.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,m.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Book Your Stay"}),(0,m.jsx)("p",{className:"text-gray-600",children:"Fill in the details to complete your booking"})]}),g&&(0,m.jsx)("div",{className:"mx-6 mt-4 bg-red-50 border-l-4 border-red-400 p-4",children:(0,m.jsxs)("div",{className:"flex",children:[(0,m.jsx)("div",{className:"flex-shrink-0",children:(0,m.jsx)("svg",{className:"h-5 w-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,m.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,m.jsx)("div",{className:"ml-3",children:(0,m.jsx)("p",{className:"text-sm text-red-700",children:g})})]})}),(0,m.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};if(b.checkInDate){const s=new Date(b.checkInDate),t=new Date;if(t.setHours(0,0,0,0),s<t&&(e.checkInDate="Check-in date cannot be in the past"),null!==j&&void 0!==j&&j.availableFrom){const t=new Date(j.availableFrom);t.setHours(0,0,0,0),s<t&&(e.checkInDate=`PG is only available from ${t.toLocaleDateString()}`)}}else e.checkInDate="Check-in date is required";return b.duration?b.duration<1?e.duration="Duration must be at least 1 month":b.duration>12&&(e.duration="Duration cannot exceed 12 months"):e.duration="Duration is required",b.occupants?b.occupants<1?e.occupants="At least 1 occupant is required":null!==j&&void 0!==j&&j.maxOccupancy&&b.occupants>j.maxOccupancy&&(e.occupants=`Maximum ${j.maxOccupancy} occupants allowed`):e.occupants="Number of occupants is required",v(e),0===Object.keys(e).length})())try{const e=await h({listingId:p,...b,amount:E()});e.success&&s(`/bookings/${e.bookingId}/confirm`)}catch(t){console.error("Booking error:",t)}},className:"p-6",children:[(0,m.jsxs)("div",{className:"grid grid-cols-1 gap-6",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"checkInDate",className:"block text-sm font-medium text-gray-700",children:"Check-in Date"}),(0,m.jsxs)("div",{className:"mt-1",children:[(0,m.jsx)("input",{type:"date",id:"checkInDate",name:"checkInDate",value:b.checkInDate,onChange:I,min:(new Date).toISOString().split("T")[0],className:`appearance-none block w-full px-3 py-2 border ${y.checkInDate?"border-red-300":"border-gray-300"} rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-[#FE6F61] focus:border-[#FE6F61] sm:text-sm`}),y.checkInDate&&(0,m.jsx)("p",{className:"mt-2 text-sm text-red-600",children:y.checkInDate}),(0,m.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Available from ",new Date(j.availableFrom).toLocaleDateString()]})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"duration",className:"block text-sm font-medium text-gray-700",children:"Duration (in months)"}),(0,m.jsxs)("div",{className:"mt-1",children:[(0,m.jsx)("select",{id:"duration",name:"duration",value:b.duration,onChange:I,className:`appearance-none block w-full px-3 py-2 border ${y.duration?"border-red-300":"border-gray-300"} rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-[#FE6F61] focus:border-[#FE6F61] sm:text-sm`,children:[1,2,3,4,5,6,7,8,9,10,11,12].map((e=>(0,m.jsxs)("option",{value:e,children:[e," ",1===e?"month":"months"]},e)))}),y.duration&&(0,m.jsx)("p",{className:"mt-2 text-sm text-red-600",children:y.duration})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"occupants",className:"block text-sm font-medium text-gray-700",children:"Number of Occupants"}),(0,m.jsxs)("div",{className:"mt-1",children:[(0,m.jsx)("input",{type:"number",id:"occupants",name:"occupants",value:b.occupants,onChange:I,min:"1",max:j.maxOccupancy||4,className:`appearance-none block w-full px-3 py-2 border ${y.occupants?"border-red-300":"border-gray-300"} rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-[#FE6F61] focus:border-[#FE6F61] sm:text-sm`}),y.occupants&&(0,m.jsx)("p",{className:"mt-2 text-sm text-red-600",children:y.occupants}),(0,m.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Maximum ",j.maxOccupancy||"N/A"," occupants allowed"]})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700",children:"Message to Owner (Optional)"}),(0,m.jsx)("div",{className:"mt-1",children:(0,m.jsx)("textarea",{id:"message",name:"message",value:b.message,onChange:I,rows:"3",className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-[#FE6F61] focus:border-[#FE6F61] sm:text-sm",placeholder:"Any special requests or questions..."})})]})]}),(0,m.jsx)("div",{className:"mt-6",children:(0,m.jsx)("button",{type:"submit",disabled:u,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-[#FE6F61] hover:bg-[#e55a4d] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#FE6F61] disabled:opacity-50 disabled:cursor-not-allowed",children:u?(0,m.jsx)(d.A,{size:"small",color:"white"}):"Confirm Booking"})})]})]})}),(0,m.jsx)("div",{className:"lg:col-span-1",children:(0,m.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden sticky top-4",children:[(0,m.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,m.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Booking Summary"})}),(0,m.jsxs)("div",{className:"p-6",children:[(0,m.jsx)("div",{className:"mb-6",children:(0,m.jsxs)("div",{className:"flex items-start",children:[(0,m.jsx)("div",{className:"w-20 h-20 bg-gray-200 rounded-md overflow-hidden flex-shrink-0",children:(0,m.jsx)("img",{src:j.images[0]||"/images/placeholder.jpg",alt:j.title,className:"w-full h-full object-cover"})}),(0,m.jsxs)("div",{className:"ml-4",children:[(0,m.jsx)("h3",{className:"text-md font-semibold text-gray-900",children:j.title}),(0,m.jsxs)("p",{className:"text-sm text-gray-600",children:[j.location.name,", ",j.location.city]}),(0,m.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[j.type," | ",j.occupancy]})]})]})}),(0,m.jsxs)("div",{className:"mb-6",children:[(0,m.jsx)("h3",{className:"text-md font-semibold text-gray-900 mb-3",children:"Price Details"}),(0,m.jsxs)("div",{className:"space-y-2",children:[(0,m.jsxs)("div",{className:"flex justify-between",children:[(0,m.jsx)("span",{className:"text-sm text-gray-600",children:"Monthly Rent"}),(0,m.jsx)("span",{className:"text-sm text-gray-900",children:C(j.price)})]}),(0,m.jsxs)("div",{className:"flex justify-between",children:[(0,m.jsx)("span",{className:"text-sm text-gray-600",children:"Duration"}),(0,m.jsxs)("span",{className:"text-sm text-gray-900",children:[b.duration," ",1===b.duration?"month":"months"]})]}),(0,m.jsxs)("div",{className:"flex justify-between",children:[(0,m.jsx)("span",{className:"text-sm text-gray-600",children:"Security Deposit"}),(0,m.jsx)("span",{className:"text-sm text-gray-900",children:C(j.securityDeposit)})]}),(0,m.jsxs)("div",{className:"pt-2 mt-2 border-t border-gray-200 flex justify-between",children:[(0,m.jsx)("span",{className:"font-semibold text-gray-900",children:"Total Amount"}),(0,m.jsx)("span",{className:"font-semibold text-[#FE6F61]",children:C(E())})]})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h3",{className:"text-md font-semibold text-gray-900 mb-3",children:"Cancellation Policy"}),(0,m.jsx)("p",{className:"text-sm text-gray-600",children:"Free cancellation within 24 hours of booking. After that, the security deposit is non-refundable."})]})]})]})})]})]})})})}}}]);
//# sourceMappingURL=242.1080a8d0.chunk.js.map