"use strict";(self.webpackChunkroomsonrent_frontend=self.webpackChunkroomsonrent_frontend||[]).push([[340],{4340:(e,s,n)=>{n.r(s),n.d(s,{default:()=>m});var t=n(5043),r=n(3216),o=n(5475),i=n(7760),a=n(9133),l=n(5336),d=n(2746),c=n(579);const m=()=>{const{getAllUserBookings:e,loading:s,error:n,cancelBooking:m}=(0,i.B)(),{user:x}=(0,a.As)(),g=(0,r.Zp)(),[u,h]=(0,t.useState)([]),[p,b]=(0,t.useState)(!0),[f,v]=(0,t.useState)(null),[y,j]=(0,t.useState)("upcoming"),[N,w]=(0,t.useState)(null);(0,t.useEffect)((()=>{if(!x)return void g("/login",{state:{from:"/profile/bookings"}});(async()=>{try{const s=await e();h(s),b(!1)}catch(s){console.error("Error fetching bookings:",s),v("Failed to load bookings. Please try again later."),b(!1)}})()}),[e,g,x]);const k=e=>new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"}),F=u.filter((e=>{const s=new Date,n=new Date(e.checkInDate);return"upcoming"===y?n>=s&&["pending","confirmed"].includes(e.status):"past"===y?n<s:"cancelled"!==y||"cancelled"===e.status}));return p?(0,c.jsx)(l.A,{children:(0,c.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,c.jsx)(d.A,{size:"large",color:"indigo"})})}):(0,c.jsx)(l.A,{children:(0,c.jsx)("div",{className:"bg-gray-50 min-h-screen py-8",children:(0,c.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,c.jsxs)("div",{className:"mb-8",children:[(0,c.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"My Bookings"}),(0,c.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Manage your PG bookings and view booking status"})]}),f&&(0,c.jsx)("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 mb-6 rounded-md",children:(0,c.jsxs)("div",{className:"flex",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:(0,c.jsx)("svg",{className:"h-5 w-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,c.jsx)("div",{className:"ml-3",children:(0,c.jsx)("p",{className:"text-sm text-red-700",children:f})})]})}),(0,c.jsx)("div",{className:"border-b border-gray-200 mb-6",children:(0,c.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,c.jsx)("button",{onClick:()=>j("upcoming"),className:("upcoming"===y?"border-[#FE6F61] text-[#FE6F61]":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300")+" whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm",children:"Upcoming Bookings"}),(0,c.jsx)("button",{onClick:()=>j("past"),className:("past"===y?"border-[#FE6F61] text-[#FE6F61]":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300")+" whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm",children:"Past Bookings"}),(0,c.jsx)("button",{onClick:()=>j("cancelled"),className:("cancelled"===y?"border-[#FE6F61] text-[#FE6F61]":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300")+" whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm",children:"Cancelled Bookings"})]})}),0===F.length?(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 text-center",children:[(0,c.jsx)("img",{src:"/images/no-bookings.svg",alt:"No bookings",className:"w-48 h-48 mx-auto opacity-50"}),(0,c.jsx)("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"No bookings found"}),(0,c.jsx)("p",{className:"mt-1 text-gray-500",children:"upcoming"===y?"You don't have any upcoming bookings.":"past"===y?"You don't have any past bookings.":"You don't have any cancelled bookings."}),"upcoming"===y&&(0,c.jsx)("div",{className:"mt-6",children:(0,c.jsx)(o.N_,{to:"/search",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-[#FE6F61] hover:bg-[#e55a4d] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#FE6F61]",children:"Find PG Accommodations"})})]}):(0,c.jsx)("div",{className:"space-y-6",children:F.map((e=>{var s,n,t,r,i,a,l,x,g,u,p,b;return(0,c.jsx)("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:(0,c.jsxs)("div",{className:"lg:flex",children:[(0,c.jsx)("div",{className:"lg:w-1/4 h-48 lg:h-auto bg-gray-200 overflow-hidden",children:(0,c.jsx)("img",{src:(null===(s=e.listing)||void 0===s||null===(n=s.images)||void 0===n?void 0:n[0])||"/images/placeholder.jpg",alt:(null===(t=e.listing)||void 0===t?void 0:t.title)||"Property",className:"w-full h-full object-cover"})}),(0,c.jsxs)("div",{className:"p-6 lg:w-3/4",children:[(0,c.jsxs)("div",{className:"lg:flex justify-between items-start",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:(0,c.jsx)(o.N_,{to:`/listings/${null===(r=e.listing)||void 0===r?void 0:r._id}`,className:"hover:text-[#FE6F61]",children:(null===(i=e.listing)||void 0===i?void 0:i.title)||"Property Title"})}),(0,c.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[null===(a=e.listing)||void 0===a||null===(l=a.location)||void 0===l?void 0:l.name,", ",(null===(x=e.listing)||void 0===x||null===(g=x.location)||void 0===g?void 0:g.city)||"Location"]}),(0,c.jsxs)("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-3 gap-2",children:[(0,c.jsxs)("div",{className:"text-sm text-gray-500",children:[(0,c.jsx)("span",{className:"font-medium",children:"Check-in:"})," ",k(e.checkInDate)]}),(0,c.jsxs)("div",{className:"text-sm text-gray-500",children:[(0,c.jsx)("span",{className:"font-medium",children:"Duration:"})," ",e.duration," ",1===e.duration?"month":"months"]}),(0,c.jsxs)("div",{className:"text-sm text-gray-500",children:[(0,c.jsx)("span",{className:"font-medium",children:"Amount:"})," ",(b=e.amount,new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(b))]})]})]}),(0,c.jsxs)("div",{className:"mt-4 lg:mt-0 flex flex-col items-end",children:[(0,c.jsx)("div",{className:"px-3 py-1 rounded-full text-xs font-medium "+("confirmed"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)}),(0,c.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Booked on ",k(e.createdAt)]})]})]}),(0,c.jsxs)("div",{className:"mt-6 flex flex-wrap gap-3",children:[(0,c.jsx)(o.N_,{to:`/bookings/${e._id}`,className:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-1 focus:ring-[#FE6F61]",children:"View Details"}),["pending","confirmed"].includes(e.status)&&new Date(e.checkInDate)>new Date&&(0,c.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to cancel this booking? This action cannot be undone.")){w(e);try{await m(e),h((s=>s.map((s=>s._id===e?{...s,status:"cancelled"}:s))))}catch(s){console.error("Error canceling booking:",s),alert("Failed to cancel booking. Please try again.")}finally{w(null)}}})(e._id),disabled:N===e._id,className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-1 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",children:N===e._id?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(d.A,{size:"tiny",color:"white"}),(0,c.jsx)("span",{className:"ml-1",children:"Cancelling..."})]}):"Cancel Booking"}),(null===(u=e.listing)||void 0===u||null===(p=u.owner)||void 0===p?void 0:p.phone)&&["confirmed","pending"].includes(e.status)&&(0,c.jsxs)("a",{href:`tel:${e.listing.owner.phone}`,className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-1 focus:ring-green-500",children:[(0,c.jsx)("svg",{className:"w-3 h-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),"Contact Owner"]})]})]})]})},e._id)}))})]})})})}}}]);
//# sourceMappingURL=340.1b50b225.chunk.js.map